@page "/project/{slug}"
@inject HttpClient Http

<section class="post">
    @if (project == null)
    {
        <p><em>Loading project data...</em></p>
    }
    else
    {
        <img class="" src="@project.CoverImagePath" alt="Project banner">
        <h1>@project.Title</h1>
        <span class="small">@StateToString(project.State)</span>
        <StarCounter Slug="@project.Slug" Type="Project" @bind-Count=@project.Stars />
        <p class="content">
            @((MarkupString)Markdig.Markdown.ToHtml(project.Excerpt))
        </p>
        @foreach (var update in project.Updates)
        {
            <div>
                <h3>@update.Title</h3>
                <span class="small">@update.Created</span>
                @((MarkupString)Markdig.Markdown.ToHtml(update.Content))
            </div>
        }
        <a href="/projects">Back</a>
    }
</section>

@code {
    private Project project;
    [Parameter]
    public string Slug { get; set; }

    protected override async Task OnInitializedAsync()
    {
        project = await Http.GetFromJsonAsync<Project>($"https://trigganfunctions.azurewebsites.net/api/Project/{Slug}");
    }

    private string StateToString(Model.Enums.ProjectState state)
    {
        return state.ToString().Replace("_", " ");
    }
}
